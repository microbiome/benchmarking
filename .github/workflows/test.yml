name: test
on:
  workflow_run:
    workflows: "CI"
    types:
      - completed
      
jobs:
  on-success:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
    - name: Check out
      uses: actions/checkout@v2
      
    - name: Finalise reports
      env:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
      run: |
        sed -i '' 's/"testmethod"/melt/g' reports/{melt,big_melt}.md
        sed -i '' 's/"testmethod"/agglomerate/g' reports/{agglomerate,big_agglomerate}.md
        sed -i '' 's/"testmethod"/transform/g' reports/{transform,big_transform}.md
        sed -i '' 's/"testmethod"/alpha/g' reports/{alpha,big_alpha}.md
        sed -i '' 's/"testmethod"/beta/g' reports/beta.md
        
    - name: Commit results
      run: |
        git config --local user.email "actions@github.com"
        git config --local user.name "GitHub Actions"
        git commit reports -m 'Finalise reports' || echo "No changes to commit"
        git push origin || echo "No changes to commit"
      
