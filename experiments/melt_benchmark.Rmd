---
title: "Benchmarking computational efficiency of TreeSE methods"
author: "Giulio Benedetti and Leo Lahti"
date: "`r Sys.Date()`"
---

# Melting Experiment

```{r parameters, echo = FALSE}
# define sample size N and rank R for the plots
N <- 100
R <- "Order"
```


```{r experiment, echo = FALSE, warning = FALSE}
# run benchmark on melting of tse and pseq with custom sample sizes
df_melt <- experiment_benchmark(containers, df, melt_tse_exec_time, melt_pseq_exec_time, sample_sizes)

# merge results from each data set into one data frame
df_melt <- df_melt %>% merge_all() %>% filter(!is.na(Time))
```

## Plot of execution times vs number of features with fixed number of samples

```{r melt_ex_time, echo = FALSE}
# plot execution time for melting subsets from
# the taxonomic rank "Order" and with 1000 samples 
p1_melt <- plot_exec_time(df_melt, N, R)
print(p1_melt)
```

## Plot of tse-to-pseq ratio of vs number of features

```{r melt_ratio, echo = FALSE, fig.width = 10, fig.height = 6}
# make data frame with Time Ratio of tse to pseq execution time of experiment
dfsub <- pivot_wider(filter(df_melt, Samples == N, Rank == R)[ , c("Dataset", "Time", "Features", "ObjectType")], 
                     names_from = c(ObjectType),
                     values_from = Time, Features) %>%
  mutate(Ratio = tse / pseq)

# plot execution time ratio for melting subsets from
# the taxonomic rank "Order" and with 1000 samples
p2_melt <- plot_ratio(dfsub)
print(p2_melt)
```

## Plot of execution times vs number of features for multiple combinations of taxonomic ranks and sample sizes

```{r melt_multi_ex_time, echo = FALSE, warning = FALSE}
p <- ggplot(df, aes(x = Features, y = Time * 1000, color = Command)) + 
    geom_point() + 
    geom_line() +
    labs(title = "Melting comparison",
         x = "Features (D)",
         y = "Execution time (ms)",
         color = "Method:",
         caption = "Execution time of melting as a function of number of features") +
    scale_x_log10() + # Log is often useful with sample size
    # scale_y_log10() + # Log is often useful with sample size
    scale_color_manual(values = c("black", "darkgray")) +
    facet_grid(Samples ~ Rank)
  
  return(p)
  

print(p)
```
